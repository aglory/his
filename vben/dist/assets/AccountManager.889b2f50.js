var e=Object.defineProperty,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,a=(o,t,n)=>t in o?e(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n,s=("undefined"!=typeof require&&require,(e,o,t)=>new Promise(((n,a)=>{var s=e=>{try{l(t.next(e))}catch(o){a(o)}},r=e=>{try{l(t.throw(e))}catch(o){a(o)}},l=e=>e.done?n(e.value):Promise.resolve(e.value).then(s,r);l((t=t.apply(e,o)).next())})));import{_ as r,u as l}from"./useTable.7d8a6e5e.js";import{_ as i,u as d,a as c}from"./useForm.e9f08473.js";import{P as u}from"./index.24ce52d8.js";import{B as m,u as p,a as f}from"./index.21fd786f.js";import{af as g,ag as h,b}from"./index.e1fec598.js";import{a7 as I,m as w,B as P,j as y,N as R,n as x,O as v,V as M,Q as j,S as T,av as C,a1 as S}from"./vendor.8be1affb.js";import{a as k,b as A,c as L,d as F,e as B}from"./account.56f00c8e.js";import"./index.1c224cd3.js";/* empty css              *//* empty css              *//* empty css              */import"./useContentViewHeight.1cc3b3a8.js";/* empty css              */import"./useSortable.92d684a3.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              */const O=[{label:"站点Id",field:"SiteId",component:"Input",colProps:{span:4},show:!1},{label:"登录帐号",field:"LoginName",component:"Input",colProps:{span:4}},{label:"真实姓名",field:"RealName",component:"Input",colProps:{span:4}},{label:"手机",field:"Tel",component:"Input",colProps:{span:4}},{label:"创建时间",field:"CreateTime",component:"RangePicker",componentProps:{"show-time":!0},colProps:{span:6}}],V=[{title:"编号",dataIndex:"Id",align:"center",width:80,sorter:!0},{title:"登录帐号",dataIndex:"LoginName",align:"left",width:120,sorter:!0},{title:"真实姓名",dataIndex:"RealName",align:"left",width:120,sorter:!0},{title:"手机",dataIndex:"Tel",align:"center",width:120,sorter:!0},{title:"类型",dataIndex:"Type",align:"center",width:120,customRender:({record:e})=>void 0!==e.Type?g(h,e.Type,"-"):"",sorter:!0},{title:"角色",dataIndex:"Role",align:"left"},{title:"状态",dataIndex:"IsLocked",align:"center",width:100,customRender:({record:e})=>e.IsLocked?I("span",{className:"page-lock"},"锁定"):I("span",{className:"page-unlock"},"启用"),filters:[{text:"锁定",value:1},{text:"启用",value:0}],sorter:!0},{title:"创建时间",dataIndex:"CreateTime",width:160,sorter:!0}],q=[{label:"编号",field:"Id",defaultValue:0,component:"Input",show:!1},{label:"类型",field:"Type",component:"Select",ifShow:!0,required:!0},{label:"登录帐号",field:"LoginName",defaultValue:"",component:"Input",rules:[{required:!0,message:"登录帐号必须为2至50个字符"},{max:50,min:2,message:"登录帐号必须为2至50个字符"}]},{label:"密码",field:"Password",defaultValue:"",component:"StrengthMeter",required:!0,show:!1},{label:"重复密码",field:"RepeatPassword",defaultValue:"",component:"StrengthMeter",dynamicRules:({values:e})=>[{required:!0,validator:(o,t)=>t?t!==e.Password?Promise.reject("两次输入的密码不一致!"):Promise.resolve():Promise.reject("密码不能为空")}],show:!1},{label:"真实姓名",field:"RealName",component:"Input",required:!0},{label:"手机",field:"Tel",component:"Input",required:!0,componentProps:{maxlength:11}},{label:"角色",field:"Role",component:"CheckboxGroup",componentProps:{options:[]}}],E=[{label:"编号",field:"Id",defaultValue:0,component:"Input",show:!1},{label:"密码",field:"Password",defaultValue:"",component:"StrengthMeter",required:!0,show:!0},{label:"重复密码",field:"RePassword",defaultValue:"",component:"StrengthMeter",dynamicRules:({values:e})=>[{required:!0,validator:(o,t)=>t?t!==e.Password?Promise.reject("两次输入的密码不一致!"):Promise.resolve():Promise.reject("密码不能为空")}],show:!0}];var N=w({name:"AccountEditorModal",components:{BasicModal:m,BasicForm:i},emits:["success"],setup(e,{emit:r}){const l=P({Id:0}),i=b(),[c,{setFieldsValue:u,updateSchema:m,resetFields:f,validate:g}]=d({labelWidth:100,schemas:q,showActionButtonGroup:!1,actionColOptions:{span:25}}),[I,{setModalProps:w,closeModal:R}]=p((e=>s(this,null,(function*(){l.Id=e.Id,f(),w({confirmLoading:!0,maskClosable:!1});let s=[];try{const r=yield k({Id:e.Id});0==l.Id&&(i.getUserInfo.Type==h.配置员?r.Type=h.管理员:r.Type=h.领导),s=r.TempRole.map((e=>({label:e.Name,value:e.Id}))),u(((e,s)=>{for(var r in s||(s={}))t.call(s,r)&&a(e,r,s[r]);if(o)for(var r of o(s))n.call(s,r)&&a(e,r,s[r]);return e})({},r))}catch(r){}0==l.Id?m([{field:"Password",show:!0},{field:"RepeatPassword",show:!0}]):m([{field:"Password",show:!1,required:!1},{field:"RepeatPassword",show:!1,dynamicRules:()=>[]}]),i.getUserInfo.Type==h.配置员?m([{field:"Type",defaultValue:h.管理员,componentProps:{options:[{label:h[h.管理员],value:h.管理员}],disabled:0!=l.Id}}]):m([{field:"Type",defaultValue:h.员工,componentProps:{options:[{label:h[h.领导],value:h.领导},{label:h[h.员工],value:h.员工}],disabled:0!=l.Id}}]),m([{field:"Role",componentProps:{options:s}}]),w({confirmLoading:!1})}))));return{registerModal:I,registerForm:c,getTitle:y((()=>0==l.Id?"创建帐号":"编辑帐号")),handleSubmit:function(){return s(this,null,(function*(){try{const e=yield g();w({confirmLoading:!0}),yield A(e),R(),r("success")}catch(e){}finally{w({confirmLoading:!1})}}))}}}});N.render=function(e,o,t,n,a,s){const r=R("BasicForm"),l=R("BasicModal");return x(),v(l,T(e.$attrs,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSubmit}),{default:M((()=>[j(r,{onRegister:e.registerForm},null,8,["onRegister"])])),_:1},16,["onRegister","title","onOk"])};var _=w({name:"AccountChangePasswordModal",components:{BasicModal:m,BasicForm:i},emits:["success"],setup(e,{emit:o}){const t=P({Id:0}),[n,{setFieldsValue:a,resetFields:r,validate:l}]=d({labelWidth:100,schemas:E,showActionButtonGroup:!1,actionColOptions:{span:25}}),[i,{setModalProps:c,closeModal:u}]=p((e=>s(this,null,(function*(){t.Id=e.Id,r(),c({confirmLoading:!1,maskClosable:!1}),a({Id:t.Id,Password:"",RePassword:""})}))));return{registerModal:i,registerForm:n,handleSubmit:function(){return s(this,null,(function*(){try{const e=yield l();c({confirmLoading:!0}),yield L(e),u(),o("success")}catch(e){}finally{c({confirmLoading:!1})}}))}}}});_.render=function(e,o,t,n,a,s){const r=R("BasicForm"),l=R("BasicModal");return x(),v(l,T(e.$attrs,{onRegister:e.registerModal,title:"修改密码",onOk:e.handleSubmit}),{default:M((()=>[j(r,{onRegister:e.registerForm},null,8,["onRegister"])])),_:1},16,["onRegister","onOk"])};var W=w({name:"AccountManager",components:{PageWrapper:u,BasicTable:r,TableAction:c,AccountEditorModal:N,AccountChangePasswordModal:_},setup(){const[e,{openModal:o}]=f(),[t,{openModal:n}]=f(),[a,{reload:r}]=l({title:"帐号管理",canColDrag:!0,showIndexColumn:!1,striped:!0,canResize:!0,columns:V,api:F,formConfig:{labelWidth:80,schemas:O},useSearchForm:!0,showTableSetting:!0,bordered:!0,actionColumn:{width:200,title:"操作",dataIndex:"action",slots:{customRender:"action"},fixed:"right"},showSummary:!1});function i(e){o(!0,null==e?{Id:0}:e)}function d(){r()}function c(e){return s(this,null,(function*(){try{yield B({Id:e.Id,IsLocked:!e.IsLocked}),r()}catch(o){}}))}return C("Enter",(e=>{var o;e.preventDefault(),"[object HTMLInputElement]"==(null==(o=e.target)?void 0:o.toString())&&d()})),{registerTable:a,handActionColumns:function(e){let o=[{title:"编辑",icon:"clarity:note-edit-line",onClick:()=>{i(e)}}];return e.IsLocked?o.push({title:"启用",icon:"ant-design:unlock-outlined",color:"success",onClick:()=>{c(e)}}):o.push({title:"锁定",icon:"ant-design:lock-outlined",color:"error",popConfirm:{title:"确定锁定",confirm:c.bind(null,e)}}),o.push({title:"修改密码",icon:"grommet-icons:user-admin",color:"info",onClick:()=>{!function(e){n(!0,null==e?{Id:0}:e)}(e)}}),o},registerAccountEditorModal:e,registerAccountChangePasswordModal:t,handleEdit:i,handleRefresh:d}}});const H=S("创建帐号");W.render=function(e,o,t,n,a,s){const r=R("a-button"),l=R("TableAction"),i=R("BasicTable"),d=R("AccountEditorModal"),c=R("AccountChangePasswordModal"),u=R("PageWrapper");return x(),v(u,{dense:"",contentFullHeight:"",fixedHeight:""},{default:M((()=>[j(i,{onRegister:e.registerTable},{toolbar:M((()=>[j(r,{type:"primary",onClick:o[0]||(o[0]=o=>e.handleEdit(null))},{default:M((()=>[H])),_:1})])),action:M((({record:o})=>[j(l,{actions:e.handActionColumns(o)},null,8,["actions"])])),_:1},8,["onRegister"]),j(d,{onRegister:e.registerAccountEditorModal,onSuccess:e.handleRefresh},null,8,["onRegister","onSuccess"]),j(c,{onRegister:e.registerAccountChangePasswordModal,onSuccess:e.handleRefresh},null,8,["onRegister","onSuccess"])])),_:1})};export{W as default};
