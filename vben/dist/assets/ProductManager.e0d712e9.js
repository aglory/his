var e=Object.defineProperty,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,r=(t,o,n)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[o]=n,i=("undefined"!=typeof require&&require,(e,t,o)=>new Promise(((n,r)=>{var i=e=>{try{l(o.next(e))}catch(t){r(t)}},a=e=>{try{l(o.throw(e))}catch(t){r(t)}},l=e=>e.done?n(e.value):Promise.resolve(e.value).then(i,a);l((o=o.apply(e,t)).next())})));import{_ as a,u as l}from"./useTable.7d8a6e5e.js";import{_ as s,u as d,a as c}from"./useForm.e9f08473.js";import{P as u}from"./index.24ce52d8.js";import{B as m,u as p,a as f}from"./index.21fd786f.js";import{aJ as g,aM as h,b as I,ag as b}from"./index.e1fec598.js";import{a7 as P,m as x,B as M,j as S,N as y,n as w,O as C,V as R,Q as k,S as F,av as O,a1 as v}from"./vendor.8be1affb.js";import{p as B,b as E,c as j,d as V,e as L,f as T,g as N,h as A,i as _}from"./product.367ef3c6.js";import"./index.1c224cd3.js";/* empty css              *//* empty css              *//* empty css              */import"./useContentViewHeight.1cc3b3a8.js";/* empty css              */import"./useSortable.92d684a3.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              */const W=[{label:"站点Id",field:"SiteId",component:"Input",colProps:{span:4},show:!1},{label:"代号",field:"Code",component:"Input",colProps:{span:4}},{label:"产品简称",field:"ShortName",component:"Input",colProps:{span:4}},{label:"产品全称",field:"FullName",component:"Input",colProps:{span:4}},{label:"创建时间",field:"CreateTime",component:"RangePicker",colProps:{span:6},componentProps:{"show-time":!0}}],q=[{title:"编号",dataIndex:"Id",align:"center",width:80,sorter:!0},{title:"站点Id",dataIndex:"SiteId",align:"right",width:100,sorter:!0,ifShow:!1},{title:"代号",dataIndex:"Code",align:"left",width:200,sorter:!0},{title:"产品简称",dataIndex:"ShortName",align:"left",width:200,sorter:!0},{title:"产品全称",dataIndex:"FullName",align:"left",sorter:!0},{title:"市场价格",dataIndex:"MarketPrice",align:"right",width:100,sorter:!0},{title:"销售价格",dataIndex:"Price",align:"right",width:100,sorter:!0},{title:"结算价",dataIndex:"SettlementPrice",align:"right",width:100,sorter:!0},{title:"积分",dataIndex:"Integral",align:"right",width:100,sorter:!0},{title:"销售数量",dataIndex:"SaleCopies",align:"right",width:100,sorter:!0},{title:"基础销量",dataIndex:"BaseCopies",align:"right",width:100,sorter:!0},{title:"库存",dataIndex:"NoSort",align:"center",width:120,customRender:({record:e})=>e.NoSort?P("span",{className:"page-green"},"无库存"):P("span",{className:"page-red"},"有库存"),filters:[{text:"有库存",value:0},{text:"无库存",value:1}],sorter:!0},{title:"库存数量",dataIndex:"SortCopies",align:"right",width:100,customRender:({record:e})=>e.NoSort?"-":e.SortCopies,sorter:!0},{title:"排列序号",dataIndex:"OrderIndex",align:"right",width:100,sorter:!0},{title:"状态",dataIndex:"IsLocked",align:"center",width:100,customRender:({record:e})=>e.IsLocked?P("span",{className:"page-lock"},"锁定"):P("span",{className:"page-unlock"},"启用"),filters:[{text:"锁定",value:1},{text:"启用",value:0}],sorter:!0},{title:"创建时间",dataIndex:"CreateTime",width:160,sorter:!0}],G=[{label:"编号",field:"Id",defaultValue:0,component:"Input",show:!1},{label:"类型",field:"Type",component:"Select",componentProps:{options:g(h)}},{label:"代号",field:"Code",component:"Input"},{label:"产品简称",field:"ShortName",defaultValue:"",component:"Input",rules:[{required:!0,message:"产品简称必须为2至50个字符"},{max:50,min:2,message:"产品简称必须为2至50个字符"}]},{label:"产品全称",field:"FullName",defaultValue:"",component:"Input",rules:[{required:!0,message:"产品全称必须为2至2000个字符"},{max:50,min:2,message:"产品全称必须为2至2000个字符"}]},{label:"描述",field:"Description",defaultValue:"",component:"InputTextArea",componentProps:{rows:3}},{label:"备注",field:"Remark",defaultValue:"",component:"InputTextArea",componentProps:{rows:3}}],H=[{label:"编号",field:"Id",defaultValue:0,component:"Input",show:!1},{label:"市场价格",field:"MarketPrice",defaultValue:0,component:"Input"},{label:"销售价格",field:"Price",defaultValue:0,component:"Input"},{label:"结算价",field:"SettlementPrice",defaultValue:0,component:"Input"},{label:"积分",field:"Integral",defaultValue:0,component:"Input"}],$=[{label:"编号",field:"Id",defaultValue:0,component:"Input",show:!1},{label:"销售数量",field:"SaleCopies",defaultValue:0,component:"Input",componentProps:{disabled:!0}},{label:"基础销量",field:"BaseCopies",defaultValue:0,component:"Input"},{label:"有无库存",field:"NoSort",defaultValue:!1,component:"Switch"},{label:"库存数量",field:"SortCopies",defaultValue:0,component:"Input",show:({model:e})=>e.NoSort}],D=[{label:"编号",field:"Id",defaultValue:0,component:"Input",show:!1},{label:"排列序号",field:"OrderIndex",defaultValue:0,component:"Input"}];var U=x({name:"AccountEditorModal",components:{BasicModal:m,BasicForm:s},emits:["success"],setup(e,{emit:a}){const l=M({Id:0}),[s,{setFieldsValue:c,updateSchema:u,resetFields:m,validate:f}]=d({labelWidth:100,schemas:G,showActionButtonGroup:!1,actionColOptions:{span:25}}),[g,{setModalProps:h,closeModal:I}]=p((e=>i(this,null,(function*(){l.Id=e.Id,m(),h({confirmLoading:!0,maskClosable:!1});try{const i=yield B({Id:e.Id});c(((e,i)=>{for(var a in i||(i={}))o.call(i,a)&&r(e,a,i[a]);if(t)for(var a of t(i))n.call(i,a)&&r(e,a,i[a]);return e})({},i))}catch(i){}u([{field:"Type",componentProps:{disabled:l.Id>0}}]),h({confirmLoading:!1})}))));return{registerModal:g,registerForm:s,getTitle:S((()=>0==l.Id?"创建产品":"编辑产品")),handleSubmit:function(){return i(this,null,(function*(){try{const e=yield f();h({confirmLoading:!0}),yield E(e),I(),a("success")}catch(e){}finally{h({confirmLoading:!1})}}))}}}});U.render=function(e,t,o,n,r,i){const a=y("BasicForm"),l=y("BasicModal");return w(),C(l,F(e.$attrs,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSubmit}),{default:R((()=>[k(a,{onRegister:e.registerForm},null,8,["onRegister"])])),_:1},16,["onRegister","title","onOk"])};var z=x({name:"ProductPriceEditorModal",components:{BasicModal:m,BasicForm:s},emits:["success"],setup(e,{emit:t}){const o=M({Id:0}),[n,{setFieldsValue:r,resetFields:a,validate:l}]=d({labelWidth:100,schemas:H,showActionButtonGroup:!1,actionColOptions:{span:25}}),[s,{setModalProps:c,closeModal:u}]=p((e=>i(this,null,(function*(){o.Id=e.Id,a(),c({confirmLoading:!0,maskClosable:!1});try{const e=yield j({Id:o.Id});r(e)}catch(t){}c({confirmLoading:!1})}))));return{registerModal:s,registerForm:n,handleSubmit:function(){return i(this,null,(function*(){try{const e=yield l();c({confirmLoading:!0}),yield V(e),u(),t("success")}catch(e){}finally{c({confirmLoading:!1})}}))}}}});z.render=function(e,t,o,n,r,i){const a=y("BasicForm"),l=y("BasicModal");return w(),C(l,F(e.$attrs,{onRegister:e.registerModal,title:"修改价格",onOk:e.handleSubmit}),{default:R((()=>[k(a,{onRegister:e.registerForm},null,8,["onRegister"])])),_:1},16,["onRegister","onOk"])};var J=x({name:"ProductCopiesEditorModal",components:{BasicModal:m,BasicForm:s},emits:["success"],setup(e,{emit:t}){const o=M({Id:0}),[n,{setFieldsValue:r,resetFields:a,validate:l}]=d({labelWidth:100,schemas:$,showActionButtonGroup:!1,actionColOptions:{span:25}}),[s,{setModalProps:c,closeModal:u}]=p((e=>i(this,null,(function*(){o.Id=e.Id,a(),c({confirmLoading:!0,maskClosable:!1});try{const e=yield L({Id:o.Id});e.NoSort=!!e.NoSort,r(e)}catch(t){}c({confirmLoading:!1})}))));return{registerModal:s,registerForm:n,handleSubmit:function(){return i(this,null,(function*(){try{const e=yield l();c({confirmLoading:!0}),yield T(e),u(),t("success")}catch(e){}finally{c({confirmLoading:!1})}}))}}}});J.render=function(e,t,o,n,r,i){const a=y("BasicForm"),l=y("BasicModal");return w(),C(l,F(e.$attrs,{onRegister:e.registerModal,title:"修改库存",onOk:e.handleSubmit}),{default:R((()=>[k(a,{onRegister:e.registerForm},null,8,["onRegister"])])),_:1},16,["onRegister","onOk"])};var Q=x({name:"ProductOrderIndexEditorModal",components:{BasicModal:m,BasicForm:s},emits:["success"],setup(e,{emit:t}){const o=M({Id:0,OrderIndex:0}),[n,{setFieldsValue:r,resetFields:a,validate:l}]=d({labelWidth:100,schemas:D,showActionButtonGroup:!1,actionColOptions:{span:25}}),[s,{setModalProps:c,closeModal:u}]=p((e=>i(this,null,(function*(){o.Id=e.Id,o.OrderIndex=e.OrderIndex,a(),c({confirmLoading:!1,maskClosable:!1}),r(o)}))));return{registerModal:s,registerForm:n,handleSubmit:function(){return i(this,null,(function*(){try{const e=yield l();c({confirmLoading:!0}),yield N(e),u(),t("success")}catch(e){}finally{c({confirmLoading:!1})}}))}}}});Q.render=function(e,t,o,n,r,i){const a=y("BasicForm"),l=y("BasicModal");return w(),C(l,F(e.$attrs,{onRegister:e.registerModal,title:"修改排列",onOk:e.handleSubmit}),{default:R((()=>[k(a,{onRegister:e.registerForm},null,8,["onRegister"])])),_:1},16,["onRegister","onOk"])};var K=x({name:"ProductManager",components:{PageWrapper:u,BasicTable:a,TableAction:c,ProductEditorModal:U,ProductPriceEditorModal:z,ProductCopiesEditorModal:J,ProductOrderIndexEditorModal:Q},setup(){const[e,{openModal:t}]=f(),[o,{openModal:n}]=f(),[r,{openModal:a}]=f(),[s,{openModal:d}]=f(),c=I(),[u,{reload:m}]=l({title:"产品管理",canColDrag:!0,showIndexColumn:!1,striped:!0,canResize:!0,columns:q.filter((e=>c.getUserInfo.Type===b.配置员||"SiteId"!==e.dataIndex)),api:A,formConfig:{labelWidth:80,schemas:W.filter((e=>c.getUserInfo.Type===b.配置员||"SiteId"!==e.field))},useSearchForm:!0,showTableSetting:!0,bordered:!0,actionColumn:{width:320,title:"操作",dataIndex:"action",slots:{customRender:"action"},fixed:"right"},showSummary:!1});function p(e){t(!0,null==e?{Id:0}:e)}function g(){m()}function h(e){return i(this,null,(function*(){try{yield _({Id:e.Id,IsLocked:!e.IsLocked}),m()}catch(t){}}))}return O("Enter",(e=>{var t;e.preventDefault(),"[object HTMLInputElement]"==(null==(t=e.target)?void 0:t.toString())&&g()})),{registerTable:u,handActionColumns:function(e){let t=[{title:"编辑",icon:"clarity:note-edit-line",onClick:()=>{p(e)}},{title:"改价",icon:"ant-design:account-book-outlined",onClick:()=>{!function(e){a(!0,e)}(e)}},{title:"库存",icon:"ant-design:retweet-outlined",onClick:()=>{!function(e){n(!0,e)}(e)}},{title:"排序",icon:"ant-design:ordered-list-outlined",onClick:()=>{!function(e){d(!0,e)}(e)}}];return e.IsLocked?t.push({title:"启用",icon:"ant-design:unlock-outlined",color:"success",onClick:()=>{h(e)}}):t.push({title:"锁定",icon:"ant-design:lock-outlined",color:"error",popConfirm:{title:"确定锁定",confirm:h.bind(null,e)}}),t},registerProductEditorModal:e,registerProductPriceEditorModal:r,registerProductCopiesEditorModal:o,registerProductOrderIndexEditorModal:s,handleEdit:p,handleRefresh:g}}});const X=v("创建产品");K.render=function(e,t,o,n,r,i){const a=y("a-button"),l=y("TableAction"),s=y("BasicTable"),d=y("ProductEditorModal"),c=y("ProductCopiesEditorModal"),u=y("ProductPriceEditorModal"),m=y("ProductOrderIndexEditorModal"),p=y("PageWrapper");return w(),C(p,{dense:"",contentFullHeight:"",fixedHeight:""},{default:R((()=>[k(s,{onRegister:e.registerTable},{toolbar:R((()=>[k(a,{type:"primary",onClick:t[0]||(t[0]=t=>e.handleEdit(null))},{default:R((()=>[X])),_:1})])),action:R((({record:t})=>[k(l,{actions:e.handActionColumns(t)},null,8,["actions"])])),_:1},8,["onRegister"]),k(d,{onRegister:e.registerProductEditorModal,onSuccess:e.handleRefresh},null,8,["onRegister","onSuccess"]),k(c,{onRegister:e.registerProductCopiesEditorModal,onSuccess:e.handleRefresh},null,8,["onRegister","onSuccess"]),k(u,{onRegister:e.registerProductPriceEditorModal,onSuccess:e.handleRefresh},null,8,["onRegister","onSuccess"]),k(m,{onRegister:e.registerProductOrderIndexEditorModal,onSuccess:e.handleRefresh},null,8,["onRegister","onSuccess"])])),_:1})};export{K as default};
