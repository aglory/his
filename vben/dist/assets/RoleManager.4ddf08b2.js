var e=Object.defineProperty,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,a=(t,o,n)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[o]=n,r=("undefined"!=typeof require&&require,(e,t,o)=>new Promise(((n,a)=>{var r=e=>{try{s(o.next(e))}catch(t){a(t)}},i=e=>{try{s(o.throw(e))}catch(t){a(t)}},s=e=>e.done?n(e.value):Promise.resolve(e.value).then(r,i);s((o=o.apply(e,t)).next())})));import{_ as i,u as s}from"./useTable.7d8a6e5e.js";import{_ as l,u as d,a as c}from"./useForm.e9f08473.js";import{P as m}from"./index.24ce52d8.js";import{B as u,u as p,a as f}from"./index.21fd786f.js";import{r as g,f as h,g as b}from"./account.56f00c8e.js";import{m as x,B as j,j as I,N as y,n as v,O as R,V as P,Q as w,S as M,av as C,a1 as S}from"./vendor.8be1affb.js";import"./index.1c224cd3.js";import"./index.e1fec598.js";/* empty css              *//* empty css              *//* empty css              */import"./useContentViewHeight.1cc3b3a8.js";/* empty css              */import"./useSortable.92d684a3.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              */const T=[{label:"角色",field:"Name",component:"Input",colProps:{span:4}}],E=[{title:"编号",dataIndex:"Id",align:"center",width:80,sorter:!0},{title:"角色",dataIndex:"Name",align:"left",width:120,sorter:!0},{title:"权限",dataIndex:"Permission",align:"left"},{title:"类型",dataIndex:"IsInner",align:"center",width:100,format:e=>e?"内置角色":"自定义角色",filters:[{text:"内置角色",value:1},{text:"自定义角色",value:0}],sorter:!0}],O=[{label:"编号",field:"Id",defaultValue:0,component:"Input",show:!1},{label:"角色",field:"Name",defaultValue:"",component:"Input",rules:[{required:!0,message:"角色必须为2至50个字符"},{max:50,min:2,message:"角色必须为2至50个字符"}]},{label:"权限",field:"Permission",component:"CheckboxGroup",componentProps:{options:[]}}];var B=x({name:"RoleEditorModal",components:{BasicModal:u,BasicForm:l},emits:["success"],setup(e,{emit:i}){const s=j({Id:0}),[l,{setFieldsValue:c,updateSchema:m,resetFields:u,validate:f}]=d({labelWidth:100,schemas:O,showActionButtonGroup:!1,actionColOptions:{span:25}}),[b,{setModalProps:x,closeModal:y}]=p((e=>r(this,null,(function*(){s.Id=e.Id,u();let r=[];try{x({confirmLoading:!0,maskClosable:!1});const i=yield g({Id:e.Id});r=i.TempPermission.map((e=>({label:e.Name,value:e.Id}))),c(((e,r)=>{for(var i in r||(r={}))o.call(r,i)&&a(e,i,r[i]);if(t)for(var i of t(r))n.call(r,i)&&a(e,i,r[i]);return e})({},i))}catch(i){}m([{field:"Permission",componentProps:{options:r}}]),x({confirmLoading:!1})}))));return{registerModal:b,registerForm:l,getTitle:I((()=>0==s.Id?"创建管理":"编辑管理")),handleSubmit:function(){return r(this,null,(function*(){try{const e=yield f();x({confirmLoading:!0}),yield h(e),y(),i("success")}catch(e){}finally{x({confirmLoading:!1})}}))}}}});B.render=function(e,t,o,n,a,r){const i=y("BasicForm"),s=y("BasicModal");return v(),R(s,M(e.$attrs,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSubmit}),{default:P((()=>[w(i,{onRegister:e.registerForm},null,8,["onRegister"])])),_:1},16,["onRegister","title","onOk"])};var F=x({name:"RoleManager",components:{PageWrapper:m,BasicTable:i,TableAction:c,RoleEditorModal:B},setup(){const[e,{openModal:t}]=f(),[o,{reload:n}]=s({title:"角色管理",canColDrag:!0,showIndexColumn:!1,striped:!0,canResize:!0,columns:E,api:b,formConfig:{labelWidth:80,schemas:T},useSearchForm:!0,showTableSetting:!0,bordered:!0,actionColumn:{width:200,title:"操作",dataIndex:"action",slots:{customRender:"action"},fixed:"right"},showSummary:!1});function a(e){t(!0,null==e?{Id:0}:e)}function r(){n()}return C("Enter",(e=>{var t;e.preventDefault(),"[object HTMLInputElement]"==(null==(t=e.target)?void 0:t.toString())&&r()})),{registerTable:o,handActionColumns:function(e){return[{title:"编辑",icon:"clarity:note-edit-line",onClick:()=>{a(e)}}]},registerRoleEditorModal:e,handleEdit:a,handleRefresh:r}}});const k=S("创建角色");F.render=function(e,t,o,n,a,r){const i=y("a-button"),s=y("TableAction"),l=y("BasicTable"),d=y("RoleEditorModal"),c=y("PageWrapper");return v(),R(c,{dense:"",contentFullHeight:"",fixedHeight:""},{default:P((()=>[w(l,{onRegister:e.registerTable},{toolbar:P((()=>[w(i,{type:"primary",onClick:t[0]||(t[0]=t=>e.handleEdit(null))},{default:P((()=>[k])),_:1})])),action:P((({record:t})=>[w(s,{actions:e.handActionColumns(t)},null,8,["actions"])])),_:1},8,["onRegister"]),w(d,{onRegister:e.registerRoleEditorModal,onSuccess:e.handleRefresh},null,8,["onRegister","onSuccess"])])),_:1})};export{F as default};
